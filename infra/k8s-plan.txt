Kubernetes Deployment Plan (End-to-End)

Namespace
- Name: genai
- Purpose: isolates all backend, data stores, and frontend workloads

Container Images
- Registry: docker hub (cloud driver)
- Images:
  - shettyanna/genai-gateway:latest (port 8000)
  - shettyanna/genai-chat-service:latest (port 8003)
  - shettyanna/genai-ai-service:latest (port 8004)
  - shettyanna/genai-worker:latest (no HTTP port)
  - mysql:8.0 (port 3306)
  - redis:latest (port 6379)
  - qdrant/qdrant:latest (ports 6333, 6334)
  - shettyanna/genai-frontend:latest (port 5173)

Service Discovery (DNS)
- mysql.genai.svc.cluster.local:3306
- redis.genai.svc.cluster.local:6379
- qdrant.genai.svc.cluster.local:6333
- chat-service.genai.svc.cluster.local:8003
- ai-service.genai.svc.cluster.local:8004
- gateway.genai.svc.cluster.local:8000
- frontend.genai.svc.cluster.local:5173

Environment Variables (per Deployment)
- gateway:
  - CHAT_SERVICE_URL: http://chat-service.genai.svc.cluster.local:8003
- chat-service:
  - MYSQL_DSN: mysql+pymysql://genai:genai@mysql.genai.svc.cluster.local:3306/genai_med
  - QDRANT_URL: http://qdrant.genai.svc.cluster.local:6333
  - AI_SERVICE_URL: http://ai-service.genai.svc.cluster.local:8004
- worker:
  - CELERY_BROKER_URL: redis://redis.genai.svc.cluster.local:6379/0
  - CELERY_RESULT_BACKEND: redis://redis.genai.svc.cluster.local:6379/1
  - CHAT_SERVICE_URL: http://chat-service.genai.svc.cluster.local:8003

Persistent Storage (PVCs)
- mysql-pvc: 10Gi, ReadWriteOnce, mounted at /var/lib/mysql
- qdrant-pvc: 10Gi, ReadWriteOnce, mounted at /qdrant/storage
- optional: backend-data-pvc for worker if needed

Deployments (pods)
- gateway-deployment
  - replicas: 2
  - container: genai-gateway (8000)
  - resources: requests 100m CPU/128Mi, limits 500m/256Mi
  - readiness/liveness: HTTP GET /healthz (add endpoint if missing)
- chat-service-deployment
  - replicas: 2
  - container: genai-chat-service (8003)
  - resources: requests 250m CPU/256Mi, limits 1 CPU/512Mi
  - env: MYSQL_DSN, QDRANT_URL, AI_SERVICE_URL
  - readiness/liveness: HTTP GET /healthz (add endpoint if missing)
- ai-service-deployment
  - replicas: 1–2 (depending on load)
  - container: genai-ai-service (8004)
  - resources: requests 500m CPU/512Mi, limits 2 CPU/2Gi
  - readiness/liveness: HTTP GET /healthz (add endpoint if missing)
- worker-deployment
  - replicas: 1–2
  - container: genai-worker (no HTTP)
  - command: celery worker with broker/result backend envs
  - liveness: exec ping to process or use a sidecar exporter
- mysql-statefulset
  - replicas: 1
  - pvc: mysql-pvc
  - env: MYSQL_ROOT_PASSWORD, MYSQL_DATABASE, MYSQL_USER, MYSQL_PASSWORD (use secrets)
- redis-deployment
  - replicas: 1
  - default config
- qdrant-deployment or StatefulSet
  - replicas: 1
  - pvc: qdrant-pvc
- frontend-deployment
  - replicas: 2
  - container: genai-frontend (5173)

Services (ClusterIP)
- gateway-service: port 8000 -> gateway pods
- chat-service: port 8003 -> chat pods
- ai-service: port 8004 -> ai pods
- worker: no service (not HTTP); optional metrics service if added
- mysql: port 3306
- redis: port 6379
- qdrant: ports 6333 (HTTP), 6334 (gRPC)
- frontend: port 5173

Ingress
- Controller: nginx-ingress
- TLS: cert-manager (LetsEncrypt)
- Hosts:
  - api.genai.local -> gateway-service:8000
  - app.genai.local -> frontend-service:5173
- Paths (if single domain):
  - /api -> gateway-service:8000
  - / -> frontend-service:5173

Secrets and ConfigMaps
- secrets:
  - mysql-secrets: MYSQL_ROOT_PASSWORD, MYSQL_PASSWORD
  - docker-registry secret for private pulls if needed
- configmaps:
  - non-sensitive env such as QDRANT_URL, AI_SERVICE_URL, CHAT_SERVICE_URL

Autoscaling (HPA)
- gateway: target CPU 60%, min 2, max 5
- chat-service: target CPU 60%, min 2, max 5
- ai-service: target CPU 70%, min 1, max 4

Helm Chart Structure
- charts/genai/Chart.yaml
- charts/genai/values.yaml
- charts/genai/templates/
  - namespace.yaml
  - secrets.yaml
  - configmap.yaml
  - gateway-deployment.yaml
  - gateway-service.yaml
  - chat-deployment.yaml
  - chat-service.yaml
  - ai-deployment.yaml
  - ai-service.yaml
  - worker-deployment.yaml
  - mysql-statefulset.yaml
  - mysql-service.yaml
  - redis-deployment.yaml
  - redis-service.yaml
  - qdrant-deployment.yaml
  - qdrant-service.yaml
  - frontend-deployment.yaml
  - frontend-service.yaml
  - ingress.yaml

Sample values.yaml (key excerpts)
- namespace: genai
- images:
  gateway: shettyanna/genai-gateway:latest
  chat: shettyanna/genai-chat-service:latest
  ai: shettyanna/genai-ai-service:latest
  worker: shettyanna/genai-worker:latest
  frontend: shettyanna/genai-frontend:latest
- env:
  gateway:
    CHAT_SERVICE_URL: http://chat-service.genai.svc.cluster.local:8003
  chat:
    MYSQL_DSN: mysql+pymysql://genai:genai@mysql.genai.svc.cluster.local:3306/genai_med
    QDRANT_URL: http://qdrant.genai.svc.cluster.local:6333
    AI_SERVICE_URL: http://ai-service.genai.svc.cluster.local:8004
  worker:
    CELERY_BROKER_URL: redis://redis.genai.svc.cluster.local:6379/0
    CELERY_RESULT_BACKEND: redis://redis.genai.svc.cluster.local:6379/1
    CHAT_SERVICE_URL: http://chat-service.genai.svc.cluster.local:8003
- ingress:
  enabled: true
  className: nginx
  hosts:
    - host: api.genai.local
      paths:
        - path: /
          service: gateway
          port: 8000
    - host: app.genai.local
      paths:
        - path: /
          service: frontend
          port: 5173
  tls:
    - secretName: genai-tls
      hosts:
        - api.genai.local
        - app.genai.local

Install Commands (@ indicates end-to-end planning)
- kubectl create namespace genai @
- helm upgrade --install genai charts/genai -n genai @
- Verify services:
  - kubectl get pods -n genai @
  - kubectl get svc -n genai @
  - kubectl describe ingress -n genai @

Notes
- Add /healthz endpoints to gateway, chat, ai for robust probes
- Use resource requests/limits to allow HPA
- Store sensitive envs in Secrets
- Consider managed MySQL in production
- Use imagePullSecrets if registry auth needed